<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/css/bootstrap.min.css">
<title>Review Detail</title>
</head>
<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
<body>
<h1>	
	<th:block th:each="ProductData : ${Product}">
    <span th:text="${ProductData.prdNm}"></span>
	</th:block>
</h1>
	<hr>
	<span th:text="'작성일 : ' + ${ReviewData.regDate}"></span><br/>
	<span th:text="'조회수 : ' + ${ReviewData.hit}"></span><br/>
	<span th:text="'별점 : ' + ${ReviewData.evalScore}"></span>
	<hr>
	<img class="profileImg" th:src="@{'http://localhost:9091'+${ReviewerData.profileImg}}" alt="Img" height="10%" width="10%" />
	<span class = "badge badge-success" th:text="'lvl.' + ${ReviewerData.lvl}"></span><br/>
	<span th:text="'작성자 : ' + ${ReviewData.reviewer_id}"></span>
	(<span th:text="${ReviewerData.nickNm}"></span>)<br/><br/>

	<!-- 리뷰 이미지 슬라이드 -->
	<div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
	  	  <!-- 슬라이드 콘텐츠 -->
 		  <div class="carousel-inner" style="width: auto; height: 300px; overflow: hidden">
 		  	<th:block th:each="ReviewImg : ${ReviewData.tplList}">
			  	<th:block th:if="${ReviewImgStat.index} == 0">
				    <div class="carousel-item active">
				      <img th:src="@{'http://localhost:9091'+${ReviewImg}}" class="d-block w-100" alt="Img"
				      style="width: auto; height: 300px;">
				    </div>
			    </th:block>
 			    <th:block th:unless="${ReviewImgStat.index} == 0">
				    <div class="carousel-item">
				      <img class="d-block w-100" th:src="@{'http://localhost:9091'+${ReviewImg}}" alt="Img"
				      style="width: auto; height: 300px;">
				    </div>
				</th:block> 
			</th:block>
		  </div>
		  <!-- 슬라이드 화살표, 이미지가 2개 이상일 때만 노출  -->	
		  <div class = "carousel-control" >
			  <th:block th:each="ReviewImg :  ${ReviewData.tplList} " >
				  <th:block th:if="${ReviewImgStat.count} >= 2">
					<a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
					    <span class="carousel-control-prev-icon" aria-hidden="true"></span>
					    <span class="sr-only">Previous</span>
				  	</a>
				  	<a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
					    <span class="carousel-control-next-icon" aria-hidden="true"></span>
					    <span class="sr-only">Next</span>
				 	 </a>
				  </th:block>
			  </th:block>
		  </div>
	</div>

	<!-- 리뷰 내용 -->
	<h3>GOOD</h3>
	<span th:text="${ReviewData.goodCnts}"></span><br/>
	<hr>
	<h3>ETC</h3>
	<span th:text="${ReviewData.etcCnts}"></span><br/>
	<hr>
	<span th:text="'recomCnt : ' + ${ReviewData.recomCnt}"></span><br/>
	<span th:text="'recbScore : ' + ${ReviewData.recbScore}"></span><br/>
	<hr>
	
	<!-- 리뷰 댓글 -->
	<h3>Comments</h3>
	<div class="commentForm">
            <div class="input-group">
               <input type="text" class="form-control" id="content" name="content" placeholder="내용을 입력하세요.">
               <span class="input-group-btn">
               		<button class="btn btn-success" type="button" name="commentInsertBtn">등록</button>
             </span>
     </div>
      <br>
        
       <!-- 코멘트 출력 -->
        <table id = "commentTbl">      
		<th:block th:each="Comment : ${CommentData}">
	 	<tr><td>
	 	<img class="profileImg" th:src="@{'http://localhost:9091'+${Comment.reviewer.profileImg}}" alt="Img" height="10%" width="10%" />
		<span class = "badge badge-success" th:text="'lvl.' + ${Comment.reviewer.lvl}"></span>
		</td>
		<td><span th:text="${Comment.reviewer.nickNm}"></span></td>
		<td><span th:text="${Comment.regDate}"></span></td>
		</tr>
		<tr><td>
		<span th:text="'댓글 내용 : ' + ${Comment.cnts}"></span><br/>
		</td></tr>
		</th:block>
		</table>
	
	<!-- 코멘트 더보기 페이징 -->
	<button class="btn btn-secondary" id ="moreCmtBtn"> more </button>
	</div>
	
	<hr>
	<!-- 리뷰 상품 정보 -->
	<h3>Product</h3>
	<div class ="reviewPrd">
    <span th:text="'prdSeq: ' + ${Product.prdSeq}"></span><br/>
    <span th:text="'prdNm: ' + ${Product.prdNm}"></span><br/>
    <span th:text="'salPrc: ' + ${Product.salPrc}"></span>원<br/>
	</div>



<th:block>
	<script th:inline="javascript" type="text/javascript">
	
$(document).ready(function(){	
	
		var id = [[${ReviewData._id}]] 
		var pageNo = 2;
		var url = document.location.href;
		
		$("#moreCmtBtn").click(function (){
	  		 $.ajax({
			type: 'GET',
			url : url + '/getMoreComments/' + pageNo,
			success: function (data) { 
		            var str = '<TR>';
		            $.each(data , function(i){
		                str += '<TD>' + data[i].reviewer.profileImg + '</TD><TD>' 
		                			  + 'lvl.' + data[i].reviewer.lvl + '</TD><TD>' 
		                			  + data[i].reviewer.nickNm + '</TD><TD>'
		                			  + data[i].regDate + '</TD><TR><TD>'
		                			  + data[i].cnts+ '</TD></TR>';
		                str += '</TR>';
		           });
		           $("#commentTbl").append(str); 
		           pageNo += 1;
                      },		//ajax-success
			error: function (e) {
			console.log(e);
			alert('댓글 읽기에 실패했습니다.');
			} 					//ajax-error
			});  				//ajax 
	});							//Btn-Event
});								//document-ready
    </script>
</th:block>


<script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.0/dist/umd/popper.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.4.1/js/bootstrap.min.js"></script>
</body>
</html>